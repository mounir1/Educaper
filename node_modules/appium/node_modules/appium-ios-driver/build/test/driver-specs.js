require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _ = require('../');

var _2 = _interopRequireDefault(_);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumTestSupport = require('appium-test-support');

var _teen_process = require('teen_process');

var teen_process = _interopRequireWildcard(_teen_process);

var _appiumSupport = require('appium-support');

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('driver', function () {
  it('should instantiate class', function () {
    var driver = new _2['default']();
    driver.should.exist;
  });

  describe('unsupported infrastructure', (0, _appiumTestSupport.withMocks)({ xcode: _appiumXcode2['default'] }, function (mocks) {
    var driver = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = new _2['default']();

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should throw an error for Xcode version 8+', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.xcode.expects('getVersion').once().returns({
              versionString: '8.0.0',
              versionFloat: 8.0,
              major: 8,
              minor: 0,
              patch: 0
            });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.createSession({
              platformName: 'iOS',
              deviceName: 'iPhone Simulator',
              app: '/path/to/app'
            }).should.eventually.be.rejectedWith(/Appium's IosDriver does not support xcode version 8.0.0/));

          case 3:
            mocks.xcode.verify();

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));

  describe('timeouts', function () {
    var driver = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = new _2['default']();
            // await driver.createSession({});

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    describe('command', function () {
      it('should exist by default', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              driver.newCommandTimeoutMs.should.equal(60000);

            case 1:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should be settable through `timeouts`', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.timeouts('command', 20));

            case 2:
              driver.newCommandTimeoutMs.should.equal(20);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
    describe('implicit', function () {
      it('should not exist by default', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              driver.implicitWaitMs.should.equal(0);

            case 1:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should be settable through `timeouts`', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.timeouts('implicit', 20));

            case 2:
              driver.implicitWaitMs.should.equal(20);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
    describe('page load', function () {
      it('should be settable through `timeouts`', function callee$3$0() {
        var to;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              to = driver.pageLoadMs;
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.timeouts('page load', to + 20));

            case 3:
              driver.pageLoadMs.should.equal(to + 20);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
    describe('script', function () {
      it('should be settable through `timeouts`', function callee$3$0() {
        var to;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              to = driver.asyncWaitMs;
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.timeouts('script', to + 20));

            case 3:
              driver.asyncWaitMs.should.equal(to + 20);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should be settable through asyncScriptTimeout', function callee$3$0() {
        var to;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              to = driver.asyncWaitMs;
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(to + 20));

            case 3:
              driver.asyncWaitMs.should.equal(to + 20);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
  });
});

describe('getDeviceTime', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs, teen_process: teen_process }, function (mocks) {
  it('should call idevicedate on real device', function callee$1$0() {
    var udid, date, idevicedatePath, driver;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          udid = 'some-udid';
          date = new Date().toString();
          idevicedatePath = '/path/to/idevicedate';

          mocks.fs.expects('which').once().returns(idevicedatePath);
          mocks.teen_process.expects('exec').once().withExactArgs(idevicedatePath, ['-u', udid]).returns({ stdout: date });
          driver = new _2['default']();

          driver.opts = { udid: udid };

          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(driver.getDeviceTime());

        case 9:
          context$2$0.t0 = date;
          context$2$0.sent.should.equal(context$2$0.t0);

          mocks.fs.verify();
          mocks.teen_process.verify();

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should throw an error when idevicedate cannot be found', function callee$1$0() {
    var udid, driver;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          udid = 'some-udid';

          mocks.fs.expects('which').once().throws();
          driver = new _2['default']();

          driver.opts = { udid: udid };
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.getDeviceTime().should.eventually.be.rejectedWith("Could not capture device date and time"));

        case 6:

          mocks.fs.verify();

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should throw an error when idevicedate fails', function callee$1$0() {
    var udid, idevicedatePath, driver;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          udid = 'some-udid';
          idevicedatePath = '/path/to/idevicedate';

          mocks.fs.expects('which').once().returns(idevicedatePath);
          mocks.teen_process.expects("exec").once().withExactArgs(idevicedatePath, ['-u', udid]).throws("ENOENT");
          driver = new _2['default']();

          driver.opts = { udid: udid };
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(driver.getDeviceTime().should.eventually.be.rejectedWith("Could not capture device date and time"));

        case 8:

          mocks.fs.verify();
          mocks.teen_process.verify();

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should return system date on simulator', function callee$1$0() {
    var driver;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          mocks.teen_process.expects("exec").never();
          driver = new _2['default']();
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.getDeviceTime());

        case 4:
          context$2$0.t0 = context$2$0.sent.should.be.an;
          context$2$0.t1 = String;
          context$2$0.t0 instanceof context$2$0.t1;

          mocks.teen_process.verify();

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,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LGdCQUFNLEdBQUcsbUJBQWU7OzJDQUNyQixNQUFNLENBQUMsYUFBYSxFQUFFOzs7NENBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFOzJCQUFZLE1BQU07OztBQUU3RCxlQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDOzs7Ozs7O0dBQzdCLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZHJpdmVyLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCBJb3NEcml2ZXIgZnJvbSAnLi4vJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgd2l0aE1vY2tzIH0gZnJvbSAnYXBwaXVtLXRlc3Qtc3VwcG9ydCc7XG5pbXBvcnQgKiBhcyB0ZWVuX3Byb2Nlc3MgZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHhjb2RlIGZyb20gJ2FwcGl1bS14Y29kZSc7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2RyaXZlcicsICgpID0+IHtcbiAgaXQoJ3Nob3VsZCBpbnN0YW50aWF0ZSBjbGFzcycsICgpID0+IHtcbiAgICBsZXQgZHJpdmVyID0gbmV3IElvc0RyaXZlcigpO1xuICAgIGRyaXZlci5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1bnN1cHBvcnRlZCBpbmZyYXN0cnVjdHVyZScsIHdpdGhNb2Nrcyh7eGNvZGV9LCAobW9ja3MpID0+IHtcbiAgICBsZXQgZHJpdmVyO1xuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgICBkcml2ZXIgPSBuZXcgSW9zRHJpdmVyKCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciBmb3IgWGNvZGUgdmVyc2lvbiA4KycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLnhjb2RlLmV4cGVjdHMoJ2dldFZlcnNpb24nKVxuICAgICAgICAub25jZSgpLnJldHVybnMoe1xuICAgICAgICAgIHZlcnNpb25TdHJpbmc6ICc4LjAuMCcsXG4gICAgICAgICAgdmVyc2lvbkZsb2F0OiA4LjAsXG4gICAgICAgICAgbWFqb3I6IDgsXG4gICAgICAgICAgbWlub3I6IDAsXG4gICAgICAgICAgcGF0Y2g6IDBcbiAgICAgICAgfSk7XG4gICAgICBhd2FpdCBkcml2ZXIuY3JlYXRlU2Vzc2lvbih7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2lPUycsXG4gICAgICAgIGRldmljZU5hbWU6ICdpUGhvbmUgU2ltdWxhdG9yJyxcbiAgICAgICAgYXBwOiAnL3BhdGgvdG8vYXBwJ1xuICAgICAgfSkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9BcHBpdW0ncyBJb3NEcml2ZXIgZG9lcyBub3Qgc3VwcG9ydCB4Y29kZSB2ZXJzaW9uIDguMC4wLyk7XG4gICAgICBtb2Nrcy54Y29kZS52ZXJpZnkoKTtcbiAgICB9KTtcbiAgfSkpO1xuXG4gIGRlc2NyaWJlKCd0aW1lb3V0cycsICgpID0+IHtcbiAgICBsZXQgZHJpdmVyO1xuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgICBkcml2ZXIgPSBuZXcgSW9zRHJpdmVyKCk7XG4gICAgICAvLyBhd2FpdCBkcml2ZXIuY3JlYXRlU2Vzc2lvbih7fSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ2NvbW1hbmQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGV4aXN0IGJ5IGRlZmF1bHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGRyaXZlci5uZXdDb21tYW5kVGltZW91dE1zLnNob3VsZC5lcXVhbCg2MDAwMCk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgYmUgc2V0dGFibGUgdGhyb3VnaCBgdGltZW91dHNgJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBkcml2ZXIudGltZW91dHMoJ2NvbW1hbmQnLCAyMCk7XG4gICAgICAgIGRyaXZlci5uZXdDb21tYW5kVGltZW91dE1zLnNob3VsZC5lcXVhbCgyMCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgnaW1wbGljaXQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIG5vdCBleGlzdCBieSBkZWZhdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBkcml2ZXIuaW1wbGljaXRXYWl0TXMuc2hvdWxkLmVxdWFsKDApO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGJlIHNldHRhYmxlIHRocm91Z2ggYHRpbWVvdXRzYCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZHJpdmVyLnRpbWVvdXRzKCdpbXBsaWNpdCcsIDIwKTtcbiAgICAgICAgZHJpdmVyLmltcGxpY2l0V2FpdE1zLnNob3VsZC5lcXVhbCgyMCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgncGFnZSBsb2FkJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBiZSBzZXR0YWJsZSB0aHJvdWdoIGB0aW1lb3V0c2AnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCB0byA9IGRyaXZlci5wYWdlTG9hZE1zO1xuICAgICAgICBhd2FpdCBkcml2ZXIudGltZW91dHMoJ3BhZ2UgbG9hZCcsIHRvICsgMjApO1xuICAgICAgICBkcml2ZXIucGFnZUxvYWRNcy5zaG91bGQuZXF1YWwodG8gKyAyMCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgnc2NyaXB0JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBiZSBzZXR0YWJsZSB0aHJvdWdoIGB0aW1lb3V0c2AnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCB0byA9IGRyaXZlci5hc3luY1dhaXRNcztcbiAgICAgICAgYXdhaXQgZHJpdmVyLnRpbWVvdXRzKCdzY3JpcHQnLCB0byArIDIwKTtcbiAgICAgICAgZHJpdmVyLmFzeW5jV2FpdE1zLnNob3VsZC5lcXVhbCh0byArIDIwKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBiZSBzZXR0YWJsZSB0aHJvdWdoIGFzeW5jU2NyaXB0VGltZW91dCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHRvID0gZHJpdmVyLmFzeW5jV2FpdE1zO1xuICAgICAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KHRvICsgMjApO1xuICAgICAgICBkcml2ZXIuYXN5bmNXYWl0TXMuc2hvdWxkLmVxdWFsKHRvICsgMjApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnZXREZXZpY2VUaW1lJywgd2l0aE1vY2tzKHtmcywgdGVlbl9wcm9jZXNzfSwgKG1vY2tzKSA9PiB7XG4gIGl0KCdzaG91bGQgY2FsbCBpZGV2aWNlZGF0ZSBvbiByZWFsIGRldmljZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgdWRpZCA9ICdzb21lLXVkaWQnO1xuICAgIGxldCBkYXRlID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgIGxldCBpZGV2aWNlZGF0ZVBhdGggPSAnL3BhdGgvdG8vaWRldmljZWRhdGUnO1xuICAgIG1vY2tzLmZzLmV4cGVjdHMoJ3doaWNoJylcbiAgICAgIC5vbmNlKCkucmV0dXJucyhpZGV2aWNlZGF0ZVBhdGgpO1xuICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKCdleGVjJylcbiAgICAgIC5vbmNlKCkud2l0aEV4YWN0QXJncyhpZGV2aWNlZGF0ZVBhdGgsIFsnLXUnLCB1ZGlkXSlcbiAgICAgIC5yZXR1cm5zKHtzdGRvdXQ6IGRhdGV9KTtcbiAgICBsZXQgZHJpdmVyID0gbmV3IElvc0RyaXZlcigpO1xuICAgIGRyaXZlci5vcHRzID0ge3VkaWR9O1xuXG4gICAgKGF3YWl0IGRyaXZlci5nZXREZXZpY2VUaW1lKCkpLnNob3VsZC5lcXVhbChkYXRlKTtcblxuICAgIG1vY2tzLmZzLnZlcmlmeSgpO1xuICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy52ZXJpZnkoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIGlkZXZpY2VkYXRlIGNhbm5vdCBiZSBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgdWRpZCA9ICdzb21lLXVkaWQnO1xuICAgIG1vY2tzLmZzLmV4cGVjdHMoJ3doaWNoJylcbiAgICAgIC5vbmNlKCkudGhyb3dzKCk7XG4gICAgbGV0IGRyaXZlciA9IG5ldyBJb3NEcml2ZXIoKTtcbiAgICBkcml2ZXIub3B0cyA9IHt1ZGlkfTtcbiAgICBhd2FpdCBkcml2ZXIuZ2V0RGV2aWNlVGltZSgpXG4gICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKFwiQ291bGQgbm90IGNhcHR1cmUgZGV2aWNlIGRhdGUgYW5kIHRpbWVcIik7XG5cbiAgICBtb2Nrcy5mcy52ZXJpZnkoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIGlkZXZpY2VkYXRlIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB1ZGlkID0gJ3NvbWUtdWRpZCc7XG4gICAgbGV0IGlkZXZpY2VkYXRlUGF0aCA9ICcvcGF0aC90by9pZGV2aWNlZGF0ZSc7XG4gICAgbW9ja3MuZnMuZXhwZWN0cygnd2hpY2gnKVxuICAgICAgLm9uY2UoKS5yZXR1cm5zKGlkZXZpY2VkYXRlUGF0aCk7XG4gICAgbW9ja3MudGVlbl9wcm9jZXNzLmV4cGVjdHMoXCJleGVjXCIpXG4gICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3MoaWRldmljZWRhdGVQYXRoLCBbJy11JywgdWRpZF0pXG4gICAgICAudGhyb3dzKFwiRU5PRU5UXCIpO1xuICAgIGxldCBkcml2ZXIgPSBuZXcgSW9zRHJpdmVyKCk7XG4gICAgZHJpdmVyLm9wdHMgPSB7dWRpZH07XG4gICAgYXdhaXQgZHJpdmVyLmdldERldmljZVRpbWUoKVxuICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aChcIkNvdWxkIG5vdCBjYXB0dXJlIGRldmljZSBkYXRlIGFuZCB0aW1lXCIpO1xuXG4gICAgbW9ja3MuZnMudmVyaWZ5KCk7XG4gICAgbW9ja3MudGVlbl9wcm9jZXNzLnZlcmlmeSgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiBzeXN0ZW0gZGF0ZSBvbiBzaW11bGF0b3InLCBhc3luYyAoKSA9PiB7XG4gICAgbW9ja3MudGVlbl9wcm9jZXNzLmV4cGVjdHMoXCJleGVjXCIpXG4gICAgICAubmV2ZXIoKTtcbiAgICBsZXQgZHJpdmVyID0gbmV3IElvc0RyaXZlcigpO1xuICAgIChhd2FpdCBkcml2ZXIuZ2V0RGV2aWNlVGltZSgpKS5zaG91bGQuYmUuYW4gaW5zdGFuY2VvZihTdHJpbmcpO1xuXG4gICAgbW9ja3MudGVlbl9wcm9jZXNzLnZlcmlmeSgpO1xuICB9KTtcbn0pKTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
