'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('../utils');

var commands = {};

commands.click = function callee$0$0(el) {
  var retVal;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.tapEl(el));

      case 2:
        retVal = context$1$0.sent;
        return context$1$0.abrupt('return', retVal);

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.tapEl = function callee$0$0(el, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        // perform a tap on the given element
        // if longPress is true, the tap becomes a longPress action

        el = (0, _utils.unwrapEl)(el);

        commandName = 'tap';

        if (longPress) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 7:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 9;

        result = JSON.parse(data);
        context$1$0.next = 16;
        break;

      case 13:
        context$1$0.prev = 13;
        context$1$0.t0 = context$1$0['catch'](9);
        throw new Error("Bad response from click");

      case 16:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError();

      case 18:
        return context$1$0.abrupt('return', result.value);

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[9, 13]]);
};

commands.tapElXY = function callee$0$0(el, x, y, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        // perform a tap on the given element at the given x,y offset
        // if longPress is true, the tap becomes a longPress action

        el = (0, _utils.unwrapEl)(el);

        commandName = 'tap';

        if (longPress) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + el, '' + x, '' + y]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 7:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 9;

        result = JSON.parse(data);
        context$1$0.next = 16;
        break;

      case 13:
        context$1$0.prev = 13;
        context$1$0.t0 = context$1$0['catch'](9);
        throw new Error("Bad response from tapElXY");

      case 16:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError();

      case 20:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 24;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError();

      case 24:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 26;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError();

      case 26:
        return context$1$0.abrupt('return', result.value);

      case 27:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[9, 13]]);
};

commands.tapXY = function callee$0$0(x, y, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        commandName = 'tap';

        if (longPress === true) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + x, '' + y]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 6:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 8;

        result = JSON.parse(data);
        context$1$0.next = 15;
        break;

      case 12:
        context$1$0.prev = 12;
        context$1$0.t0 = context$1$0['catch'](8);
        throw new Error("Bad response from tapXY");

      case 15:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 17;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError();

      case 17:
        return context$1$0.abrupt('return', result.value);

      case 18:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[8, 12]]);
};

commands.tap = function callee$0$0(gestures, longPress) {
  var elementId, x, y;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        elementId = gestures[0].options.element;
        x = gestures[0].options.x;
        y = gestures[0].options.y;

        if (!elementId) {
          context$1$0.next = 13;
          break;
        }

        if (!(x && y)) {
          context$1$0.next = 9;
          break;
        }

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.tapElXY(elementId, x, y, longPress));

      case 7:
        context$1$0.next = 11;
        break;

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.tapEl(elementId, longPress));

      case 11:
        context$1$0.next = 15;
        break;

      case 13:
        context$1$0.next = 15;
        return _regeneratorRuntime.awrap(this.tapXY(x, y, longPress));

      case 15:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.doSwipe = function callee$0$0(gestures, longPress) {
  var press, moveTo, startX, startY, endX, endY, _ref, x, y, _ref2, width, height, _ref3, _ref4, commandName, commandObject, commandJSON, data, result;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        press = gestures[0];
        moveTo = gestures[1];
        startX = press.options.x || 0, startY = press.options.y || 0, endX = moveTo.options.x || 0, endY = moveTo.options.y || 0;

        if (!press.options.element) {
          context$1$0.next = 17;
          break;
        }

        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.getLocation(press.options.element));

      case 6:
        _ref = context$1$0.sent;
        x = _ref.x;
        y = _ref.y;
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.getSize(press.options.element));

      case 11:
        _ref2 = context$1$0.sent;
        width = _ref2.width;
        height = _ref2.height;

        // Use the middle of the element to press on, unless an offset from
        // top left of the element has been specified
        if (!press.options.x && !press.options.y && width && height) {
          startX += width / 2;
          startY += height / 2;
        }

        startX += x || 0;
        startY += y || 0;

      case 17:
        if (!moveTo.options.element) {
          context$1$0.next = 31;
          break;
        }

        context$1$0.next = 20;
        return _regeneratorRuntime.awrap(this.getLocation(moveTo.options.element));

      case 20:
        _ref3 = context$1$0.sent;
        x = _ref3.x;
        y = _ref3.y;
        context$1$0.next = 25;
        return _regeneratorRuntime.awrap(this.getSize(moveTo.options.element));

      case 25:
        _ref4 = context$1$0.sent;
        width = _ref4.width;
        height = _ref4.height;

        endX += x || 0;
        endY += y || 0;

        // Use the middle of the element to move to, unless an offset from
        // top left of the element has been specified
        if (!moveTo.options.x && !moveTo.options.y && width && height) {
          endX += width / 2;
          endY += height / 2;
        }

      case 31:
        commandName = 'swipe';

        if (longPress === true) {
          commandName = 'longpressswipe';
        }

        commandObject = {
          name: commandName,
          args: ['' + startX, '' + startY, '' + endX, '' + endY]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 37;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 37:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 39;

        result = JSON.parse(data);
        context$1$0.next = 46;
        break;

      case 43:
        context$1$0.prev = 43;
        context$1$0.t0 = context$1$0['catch'](39);
        throw new Error("Bad response from doSwipe");

      case 46:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 48;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError();

      case 48:
        return context$1$0.abrupt('return', result.value);

      case 49:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[39, 43]]);
};

commands.performTouch = function callee$0$0(gestures) {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!(gestures.length === 3)) {
          context$1$0.next = 13;
          break;
        }

        if (!(gestures[0].action === 'press' && gestures[1].action === 'moveTo' && gestures[2].action === 'release')) {
          context$1$0.next = 7;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.doSwipe(gestures, false));

      case 4:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 7:
        if (!(gestures[0].action === 'longPress' && gestures[1].action === 'moveTo' && gestures[2].action === 'release')) {
          context$1$0.next = 11;
          break;
        }

        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.doSwipe(gestures, true));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 11:
        context$1$0.next = 24;
        break;

      case 13:
        if (!(gestures.length === 2)) {
          context$1$0.next = 24;
          break;
        }

        if (!(gestures[0].action === 'press' && gestures[1].action === 'release')) {
          context$1$0.next = 20;
          break;
        }

        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(this.tap(gestures, false));

      case 17:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 20:
        if (!(gestures[0].action === 'longPress' && gestures[1].action === 'release')) {
          context$1$0.next = 24;
          break;
        }

        context$1$0.next = 23;
        return _regeneratorRuntime.awrap(this.tap(gestures, true));

      case 23:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 24:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

exports['default'] = commands;
module.exports = exports['default'];

// get status returned

// perform a tap at the given x,y screen coordinate
// if longPress is true, the tap becomes a longPress action

// get status returned

// parse the given gestures array to call the appropriate tap method
// if longPress is true, the tap is a long press action

// we are either tapping on the default location of the element
// top left has been specified of the element has been specified

// tapping with an element parameter is the same as click on a WebElement

// we are tapping at an absolute x,y coordinate on the screen

// parse input values

// construct the command object

// get status returned
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQUF1QixvQkFBb0I7O3FCQUNZLFVBQVU7O0FBRWpFLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQzs7QUFFbEIsUUFBUSxDQUFDLEtBQUssR0FBRyxvQkFBZ0IsRUFBRTtNQUM3QixNQUFNOzs7Ozt5Q0FBUyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQzs7O0FBQTdCLGNBQU07NENBQ0gsTUFBTTs7Ozs7OztDQUNkLENBQUM7O0FBRUYsUUFBUSxDQUFDLEtBQUssR0FBRyxvQkFBZ0IsRUFBRSxFQUFFLFNBQVM7TUFPeEMsV0FBVyxFQUtYLGFBQWEsRUFJYixXQUFXLEVBRVgsSUFBSSxFQUVKLE1BQU07Ozs7Ozs7O0FBZlYsVUFBRSxHQUFHLHFCQUFTLEVBQUUsQ0FBQyxDQUFDOztBQUVkLG1CQUFXLEdBQUcsS0FBSzs7QUFDdkIsWUFBSSxTQUFTLEVBQUU7QUFDYixxQkFBVyxHQUFHLFdBQVcsQ0FBQztTQUMzQjs7QUFFRyxxQkFBYSxHQUFHO0FBQ2xCLGNBQUksRUFBRSxXQUFXO0FBQ2pCLGNBQUksRUFBRSxNQUFJLEVBQUUsQ0FBRztTQUNoQjtBQUNHLG1CQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUM7O3lDQUU5QixJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDOzs7QUFBbkQsWUFBSTtBQUVKLGNBQU07OztBQUVSLGNBQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDOzs7Ozs7O2NBRXBCLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDOzs7Y0FJeEMsTUFBTSxDQUFDLE1BQU0sS0FBSyxvQ0FBNkIsdUJBQXVCLENBQUE7Ozs7O2NBQ2xFLElBQUkseUJBQU8sMEJBQTBCLEVBQUU7Ozs0Q0FFeEMsTUFBTSxDQUFDLEtBQUs7Ozs7Ozs7Q0FDcEIsQ0FBQzs7QUFFRixRQUFRLENBQUMs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Ozs7Ozt5Q0FFdkQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDOzs7Ozs7Y0FFN0IsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBTSxXQUFXLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBTSxTQUFTLENBQUE7Ozs7Ozt5Q0FFcEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDOzs7Ozs7Ozs7O0NBSTFDLENBQUM7O3FCQUVhLFFBQVEiLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlc3R1cmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdW53cmFwRWwsIHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMgfSBmcm9tICcuLi91dGlscyc7XG5cbmxldCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5jbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBsZXQgcmV0VmFsID0gYXdhaXQgdGhpcy50YXBFbChlbCk7XG4gIHJldHVybiByZXRWYWw7XG59O1xuXG5jb21tYW5kcy50YXBFbCA9IGFzeW5jIGZ1bmN0aW9uIChlbCwgbG9uZ1ByZXNzKSB7XG5cbiAgLy8gcGVyZm9ybSBhIHRhcCBvbiB0aGUgZ2l2ZW4gZWxlbWVudFxuICAvLyBpZiBsb25nUHJlc3MgaXMgdHJ1ZSwgdGhlIHRhcCBiZWNvbWVzIGEgbG9uZ1ByZXNzIGFjdGlvblxuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kTmFtZSA9ICd0YXAnO1xuICBpZiAobG9uZ1ByZXNzKSB7XG4gICAgY29tbWFuZE5hbWUgPSAnbG9uZ3ByZXNzJztcbiAgfVxuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGNsaWNrXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVClcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKCk7XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLnRhcEVsWFkgPSBhc3luYyBmdW5jdGlvbiAoZWwsIHgsIHksIGxvbmdQcmVzcykge1xuXG4gIC8vIHBlcmZvcm0gYSB0YXAgb24gdGhlIGdpdmVuIGVsZW1lbnQgYXQgdGhlIGdpdmVuIHgseSBvZmZzZXRcbiAgLy8gaWYgbG9uZ1ByZXNzIGlzIHRydWUsIHRoZSB0YXAgYmVjb21lcyBhIGxvbmdQcmVzcyBhY3Rpb25cblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE5hbWUgPSAndGFwJztcbiAgaWYgKGxvbmdQcmVzcykge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzcyc7XG4gIH1cblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiBjb21tYW5kTmFtZSxcbiAgICBhcmdzOiBbYCR7ZWx9YCwgYCR7eH1gLCBgJHt5fWBdXG4gIH07XG5cbiAgdmFyIGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gdGFwRWxYWVwiKTtcbiAgfVxuXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IoKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcigpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMudGFwWFkgPSBhc3luYyBmdW5jdGlvbih4LCB5LCBsb25nUHJlc3MpIHtcblxuICAvLyBwZXJmb3JtIGEgdGFwIGF0IHRoZSBnaXZlbiB4LHkgc2NyZWVuIGNvb3JkaW5hdGVcbiAgLy8gaWYgbG9uZ1ByZXNzIGlzIHRydWUsIHRoZSB0YXAgYmVjb21lcyBhIGxvbmdQcmVzcyBhY3Rpb25cblxuICBsZXQgY29tbWFuZE5hbWUgPSAndGFwJztcbiAgaWYgKGxvbmdQcmVzcyA9PT0gdHJ1ZSkge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzcyc7XG4gIH1cblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiBjb21tYW5kTmFtZSxcbiAgICBhcmdzOiBbYCR7eH1gLCBgJHt5fWBdXG4gIH07XG5cbiAgdmFyIGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gdGFwWFlcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKVxuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IoKTtcblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMudGFwID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzLCBsb25nUHJlc3MpIHtcblxuICAvLyBwYXJzZSB0aGUgZ2l2ZW4gZ2VzdHVyZXMgYXJyYXkgdG8gY2FsbCB0aGUgYXBwcm9wcmlhdGUgdGFwIG1ldGhvZFxuICAvLyBpZiBsb25nUHJlc3MgaXMgdHJ1ZSwgdGhlIHRhcCBpcyBhIGxvbmcgcHJlc3MgYWN0aW9uXG5cbiAgbGV0IGVsZW1lbnRJZCA9IGdlc3R1cmVzWzBdLm9wdGlvbnMuZWxlbWVudDtcbiAgbGV0IHggPSBnZXN0dXJlc1swXS5vcHRpb25zLng7XG4gIGxldCB5ID0gZ2VzdHVyZXNbMF0ub3B0aW9ucy55O1xuXG4gIGlmIChlbGVtZW50SWQpIHtcblxuICAgIC8vIHdlIGFyZSBlaXRoZXIgdGFwcGluZyBvbiB0aGUgZGVmYXVsdCBsb2NhdGlvbiBvZiB0aGUgZWxlbWVudFxuICAgIC8vIHRvcCBsZWZ0IGhhcyBiZWVuIHNwZWNpZmllZCBvZiB0aGUgZWxlbWVudCBoYXMgYmVlbiBzcGVjaWZpZWRcblxuICAgIGlmICh4ICYmIHkpIHtcbiAgICAgIGF3YWl0IHRoaXMudGFwRWxYWShlbGVtZW50SWQsIHgsIHksIGxvbmdQcmVzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHRhcHBpbmcgd2l0aCBhbiBlbGVtZW50IHBhcmFtZXRlciBpcyB0aGUgc2FtZSBhcyBjbGljayBvbiBhIFdlYkVsZW1lbnRcbiAgICAgIGF3YWl0IHRoaXMudGFwRWwoZWxlbWVudElkLCBsb25nUHJlc3MpO1xuICAgIH1cbiAgfSBlbHNlIHtcblxuICAgIC8vIHdlIGFyZSB0YXBwaW5nIGF0IGFuIGFic29sdXRlIHgseSBjb29yZGluYXRlIG9uIHRoZSBzY3JlZW5cbiAgICBhd2FpdCB0aGlzLnRhcFhZKHgsIHksIGxvbmdQcmVzcyk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmRvU3dpcGUgPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMsIGxvbmdQcmVzcykge1xuXG4gIC8vIHBhcnNlIGlucHV0IHZhbHVlc1xuICBsZXQgcHJlc3MgPSBnZXN0dXJlc1swXTtcbiAgbGV0IG1vdmVUbyA9IGdlc3R1cmVzWzFdO1xuICBsZXQgc3RhcnRYID0gcHJlc3Mub3B0aW9ucy54IHx8IDAsXG4gICAgICBzdGFydFkgPSBwcmVzcy5vcHRpb25zLnkgfHwgMCxcbiAgICAgIGVuZFggPSBtb3ZlVG8ub3B0aW9ucy54IHx8IDAsXG4gICAgICBlbmRZID0gbW92ZVRvLm9wdGlvbnMueSB8fCAwO1xuXG4gIGlmIChwcmVzcy5vcHRpb25zLmVsZW1lbnQpIHtcbiAgICBsZXQge3gsIHl9ID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihwcmVzcy5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNpemUocHJlc3Mub3B0aW9ucy5lbGVtZW50KTtcblxuICAgIC8vIFVzZSB0aGUgbWlkZGxlIG9mIHRoZSBlbGVtZW50IHRvIHByZXNzIG9uLCB1bmxlc3MgYW4gb2Zmc2V0IGZyb21cbiAgICAvLyB0b3AgbGVmdCBvZiB0aGUgZWxlbWVudCBoYXMgYmVlbiBzcGVjaWZpZWRcbiAgICBpZiAoIXByZXNzLm9wdGlvbnMueCAmJiAhcHJlc3Mub3B0aW9ucy55ICYmIHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgc3RhcnRYICs9IHdpZHRoIC8gMjtcbiAgICAgIHN0YXJ0WSArPSBoZWlnaHQgLyAyO1xuICAgIH1cblxuICAgIHN0YXJ0WCArPSB4IHx8IDA7XG4gICAgc3RhcnRZICs9IHkgfHwgMDtcblxuICB9XG4gIFxuICBpZiAobW92ZVRvLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uKG1vdmVUby5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNpemUobW92ZVRvLm9wdGlvbnMuZWxlbWVudCk7XG4gICAgZW5kWCArPSB4IHx8IDA7XG4gICAgZW5kWSArPSB5IHx8IDA7XG5cbiAgICAvLyBVc2UgdGhlIG1pZGRsZSBvZiB0aGUgZWxlbWVudCB0byBtb3ZlIHRvLCB1bmxlc3MgYW4gb2Zmc2V0IGZyb21cbiAgICAvLyB0b3AgbGVmdCBvZiB0aGUgZWxlbWVudCBoYXMgYmVlbiBzcGVjaWZpZWRcbiAgICBpZiAoIW1vdmVUby5vcHRpb25zLnggJiYgIW1vdmVUby5vcHRpb25zLnkgJiYgd2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICBlbmRYICs9IHdpZHRoIC8gMjtcbiAgICAgIGVuZFkgKz0gaGVpZ2h0IC8gMjtcbiAgICB9XG4gIH1cblxuICAvLyBjb25zdHJ1Y3QgdGhlIGNvbW1hbmQgb2JqZWN0XG4gIGxldCBjb21tYW5kTmFtZSA9ICdzd2lwZSc7XG4gIGlmIChsb25nUHJlc3MgPT09IHRydWUpIHtcbiAgICBjb21tYW5kTmFtZSA9ICdsb25ncHJlc3Nzd2lwZSc7XG4gIH1cblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiBjb21tYW5kTmFtZSxcbiAgICBhcmdzOiBbYCR7c3RhcnRYfWAsIGAke3N0YXJ0WX1gLCBgJHtlbmRYfWAsIGAke2VuZFl9YF1cbiAgfTtcblxuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBkb1N3aXBlXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVClcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKCk7XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcblxufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG5cbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMykge1xuXG4gICAgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdtb3ZlVG8nICYmIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoZ2VzdHVyZXMsIGZhbHNlKTtcblxuICAgIH0gZWxzZSBpZiAoZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAnbG9uZ1ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdtb3ZlVG8nICYmIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoZ2VzdHVyZXMsIHRydWUpO1xuICAgIH1cblxuICB9IGVsc2UgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMikge1xuXG4gICAgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50YXAoZ2VzdHVyZXMsIGZhbHNlKTtcblxuICAgIH0gZWxzZSBpZiAoZ2VzdHVyZXNbMF0uYWN0aW9uICA9PT0gJ2xvbmdQcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uICA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnRhcChnZXN0dXJlcywgdHJ1ZSk7XG5cbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
