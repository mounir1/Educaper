require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Promise = require('babel-runtime/core-js/promise')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _ = require('..');

var _teen_process = require('teen_process');

var tp = _interopRequireWildcard(_teen_process);

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumTestSupport = require('appium-test-support');

var _appiumSupport = require('appium-support');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('utils', function () {
  describe('getInstrumentsPath', (0, _appiumTestSupport.withMocks)({ tp: tp }, function (mocks) {
    it('should retrieve path', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '/a/b/c/d\n', stderr: '' }));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.getInstrumentsPath());

          case 3:
            context$3$0.sent.should.equal('/a/b/c/d');

            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should throw an error if cannnot find Instruments', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.tp.expects('exec').once().throws(new Error('Instruments not found'));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.getInstrumentsPath().should.be.rejectedWith(/Could not find the instruments binary/));

          case 3:
            (0, _appiumTestSupport.verify)(mocks);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('getAvailableDevices', (0, _appiumTestSupport.withMocks)({ tp: tp }, function (mocks) {
    it('should work for Xcode 7.3', function callee$2$0() {
      var instrumentsOutput, devices;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            instrumentsOutput = 'Known Devices:\nINsaikrisv [C8476FF9-9BC4-5E52-AE3D-536A2E85D43B]\nAppiumParallel1 (9.2) [0120C306-95C1-4196-BC13-4196105EBEF9]\nApple TV 1080p (9.1) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]\niPad 2 (8.4) [B45264A0-551C-41A5-A636-8211C05D8003] (Simulator)\niPad 2 (9.2) [4444EB1E-BA48-4DFA-B16C-777171FCF3BC] (Simulator)\niPad Air (8.4) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF] (Simulator)';
            devices = ['AppiumParallel1 (9.2) [0120C306-95C1-4196-BC13-4196105EBEF9]', 'Apple TV 1080p (9.1) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]', 'iPad 2 (8.4) [B45264A0-551C-41A5-A636-8211C05D8003] (Simulator)', 'iPad 2 (9.2) [4444EB1E-BA48-4DFA-B16C-777171FCF3BC] (Simulator)', 'iPad Air (8.4) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF] (Simulator)'];

            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '/a/b/c/d\n', stderr: '' }));
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: instrumentsOutput, stderr: '' }));
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_.utils.getAvailableDevices());

          case 6:
            context$3$0.t0 = devices;
            context$3$0.sent.should.deep.equal(context$3$0.t0);

            (0, _appiumTestSupport.verify)(mocks);

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should work for Xcode 7.0-7.2', function callee$2$0() {
      var instrumentsOutput, devices;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            instrumentsOutput = 'Known Devices:\nINsaikrisv [C8476FF9-9BC4-5E52-AE3D-536A2E85D43B]\nAppiumParallel1 (9.2) [0120C306-95C1-4196-BC13-4196105EBEF9]\nApple TV 1080p (9.1) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]\niPad 2 (8.4) [B45264A0-551C-41A5-A636-8211C05D8003]\niPad 2 (9.2) [4444EB1E-BA48-4DFA-B16C-777171FCF3BC]\niPad Air (8.4) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF]';
            devices = ['AppiumParallel1 (9.2) [0120C306-95C1-4196-BC13-4196105EBEF9]', 'Apple TV 1080p (9.1) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]', 'iPad 2 (8.4) [B45264A0-551C-41A5-A636-8211C05D8003]', 'iPad 2 (9.2) [4444EB1E-BA48-4DFA-B16C-777171FCF3BC]', 'iPad Air (8.4) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF]'];

            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '/a/b/c/d\n', stderr: '' }));
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: instrumentsOutput, stderr: '' }));
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_.utils.getAvailableDevices());

          case 6:
            context$3$0.t0 = devices;
            context$3$0.sent.should.deep.equal(context$3$0.t0);

            (0, _appiumTestSupport.verify)(mocks);

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should work for Xcode 6', function callee$2$0() {
      var instrumentsOutput, devices;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            instrumentsOutput = 'Known Devices:\nINsaikrisv [C8476FF9-9BC4-5E52-AE3D-536A2E85D43B]\nAppiumParallel1 (8.4 Simulator) [0120C306-95C1-4196-BC13-4196105EBEF9]\nApple TV 1080p (8.4 Simulator) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]\niPad 2 (8.4 Simulator) [B45264A0-551C-41A5-A636-8211C05D8003]\niPad Air (8.2 Simulator) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF]';
            devices = ['AppiumParallel1 (8.4 Simulator) [0120C306-95C1-4196-BC13-4196105EBEF9]', 'Apple TV 1080p (8.4 Simulator) [C5957108-6BA4-4A98-9A83-4BED47EFF1BC]', 'iPad 2 (8.4 Simulator) [B45264A0-551C-41A5-A636-8211C05D8003]', 'iPad Air (8.2 Simulator) [F26279E7-8BAF-4D7B-ABFE-08D1AC364DCF]'];

            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '/a/b/c/d\n', stderr: '' }));
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: instrumentsOutput, stderr: '' }));
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_.utils.getAvailableDevices());

          case 6:
            context$3$0.t0 = devices;
            context$3$0.sent.should.deep.equal(context$3$0.t0);

            (0, _appiumTestSupport.verify)(mocks);

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should throw an error when Instruments fails', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '/a/b/c/d\n', stderr: '' }));
            mocks.tp.expects('exec').once().throws(new Error('Instruments failed'));
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_.utils.getAvailableDevices().should.be.rejectedWith(/Failed getting devices, err: Error: Instruments failed./));

          case 4:
            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('killAllInstruments', (0, _appiumTestSupport.withMocks)({ tp: tp }, function (mocks) {
    it('should work', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.tp.expects('exec').once().returns(_Promise.resolve({ stdout: '', stderr: '' }));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.killAllInstruments());

          case 3:
            (0, _appiumTestSupport.verify)(mocks);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('cleanAllTraces', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs }, function (mocks) {
    (0, _appiumTestSupport.stubEnv)();
    it('should work', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            process.env.CLEAN_TRACES = 1;
            mocks.fs.expects('rimraf').once().returns(_Promise.resolve({ stdout: '', stderr: '' }));
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_.utils.cleanAllTraces());

          case 4:
            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('parseLaunchTimeout', function () {
    (0, _appiumTestSupport.stubEnv)();
    it('should work', function () {
      _.utils.parseLaunchTimeout(90000).should.deep.equal({
        global: 90000 });
      _.utils.parseLaunchTimeout('90000').should.deep.equal({
        global: 90000 });
      _.utils.parseLaunchTimeout({ global: 90000, afterLaunch: 30000 }).should.deep.equal({
        global: 90000, afterLaunch: 30000 });
      _.utils.parseLaunchTimeout('{"global": 90000, "afterLaunch": 30000}').should.deep.equal({
        global: 90000, afterLaunch: 30000 });
    });
    it('should work with invalid JSON', function () {
      _.utils.parseLaunchTimeout('x').should.equal('x');
    });
  });
  describe('getIwdPath', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs }, function (mocks) {
    it('should work when path is found', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects('exists').once().returns(_Promise.resolve(true));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.getIwdPath('10'));

          case 3:
            context$3$0.sent.should.match(/.*thirdparty\/iwd10/);

            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should work when path is not found', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects('exists').once().returns(_Promise.resolve(false));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.getIwdPath('10'));

          case 3:
            context$3$0.sent.should.match(/.*thirdparty\/iwd/);

            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));

  describe('quickLaunch', (0, _appiumTestSupport.withMocks)({ fs: _appiumSupport.fs, tp: tp }, function (mocks) {
    it('should remove trace directory', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.fs.expects('rimraf').once().returns(_Promise.resolve());
            mocks.tp.expects('exec').once().withArgs('xcrun').returns(_Promise.resolve({ stdout: '', stderr: '' }));
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_.utils.quickLaunch());

          case 4:
            (0, _appiumTestSupport.verify)(mocks);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));

  describe('quickInstruments', (0, _appiumTestSupport.withMocks)({ xcode: _appiumXcode2['default'] }, function (mocks) {
    it('should create an Instruments object', function callee$2$0() {
      var inst;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_.utils.quickInstruments({
              xcodeTraceTemplatePath: '/some/path'
            }));

          case 2:
            inst = context$3$0.sent;

            inst.should.be.an['instanceof'](_.Instruments);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should get xcode trace template if none supplied', function callee$2$0() {
      var inst;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.xcode.expects('getAutomationTraceTemplatePath').once().returns(_Promise.resolve('/some/path'));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_.utils.quickInstruments());

          case 3:
            inst = context$3$0.sent;

            inst.template.should.equal('/some/path');

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
});
//# sourceMappingURL=data:application/json;base64,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Q0FBQyxDQUFDOzs7Ozs7O0tBQzFDLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQyxDQUFDO0NBQ0wsQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvdXRpbHMtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHsgdXRpbHMsIEluc3RydW1lbnRzIH0gZnJvbSAnLi4nO1xuaW1wb3J0ICogYXMgdHAgZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgeyB3aXRoTW9ja3MsIHZlcmlmeSwgc3R1YkVudiB9IGZyb20gJ2FwcGl1bS10ZXN0LXN1cHBvcnQnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ3V0aWxzJywgKCkgPT4ge1xuICBkZXNjcmliZSgnZ2V0SW5zdHJ1bWVudHNQYXRoJywgd2l0aE1vY2tzKHt0cH0sIChtb2NrcykgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogJy9hL2IvYy9kXFxuJywgc3RkZXJyOicnIH0pKTtcbiAgICAgIChhd2FpdCB1dGlscy5nZXRJbnN0cnVtZW50c1BhdGgoKSkuc2hvdWxkLmVxdWFsKCcvYS9iL2MvZCcpO1xuICAgICAgdmVyaWZ5KG1vY2tzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIGNhbm5ub3QgZmluZCBJbnN0cnVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAudGhyb3dzKG5ldyBFcnJvcignSW5zdHJ1bWVudHMgbm90IGZvdW5kJykpO1xuICAgICAgYXdhaXQgdXRpbHMuZ2V0SW5zdHJ1bWVudHNQYXRoKCkuc2hvdWxkLmJlLnJlamVjdGVkV2l0aCgvQ291bGQgbm90IGZpbmQgdGhlIGluc3RydW1lbnRzIGJpbmFyeS8pO1xuICAgICAgdmVyaWZ5KG1vY2tzKTtcbiAgICB9KTtcbiAgfSkpO1xuICBkZXNjcmliZSgnZ2V0QXZhaWxhYmxlRGV2aWNlcycsIHdpdGhNb2Nrcyh7dHB9LCAobW9ja3MpID0+IHtcbiAgICBpdCgnc2hvdWxkIHdvcmsgZm9yIFhjb2RlIDcuMycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBpbnN0cnVtZW50c091dHB1dCA9IGBLbm93biBEZXZpY2VzOlxuSU5zYWlrcmlzdiBbQzg0NzZGRjktOUJDNC01RTUyLUFFM0QtNTM2QTJFODVENDNCXVxuQXBwaXVtUGFyYWxsZWwxICg5LjIpIFswMTIwQzMwNi05NUMxLTQxOTYtQkMxMy00MTk2MTA1RUJFRjldXG5BcHBsZSBUViAxMDgwcCAoOS4xKSBbQzU5NTcxMDgtNkJBNC00QTk4LTlBODMtNEJFRDQ3RUZGMUJDXVxuaVBhZCAyICg4LjQpIFtCNDUyNjRBMC01NTFDLTQxQTUtQTYzNi04MjExQzA1RDgwMDNdIChTaW11bGF0b3IpXG5pUGFkIDIgKDkuMikgWzQ0NDRFQjFFLUJBNDgtNERGQS1CMTZDLTc3NzE3MUZDRjNCQ10gKFNpbXVsYXRvcilcbmlQYWQgQWlyICg4LjQpIFtGMjYyNzlFNy04QkFGLTREN0ItQUJGRS0wOEQxQUMzNjREQ0ZdIChTaW11bGF0b3IpYDtcbiAgICAgIGxldCBkZXZpY2VzID0gW1xuICAgICAgICAnQXBwaXVtUGFyYWxsZWwxICg5LjIpIFswMTIwQzMwNi05NUMxLTQxOTYtQkMxMy00MTk2MTA1RUJFRjldJyxcbiAgICAgICAgJ0FwcGxlIFRWIDEwODBwICg5LjEpIFtDNTk1NzEwOC02QkE0LTRBOTgtOUE4My00QkVENDdFRkYxQkNdJyxcbiAgICAgICAgJ2lQYWQgMiAoOC40KSBbQjQ1MjY0QTAtNTUxQy00MUE1LUE2MzYtODIxMUMwNUQ4MDAzXSAoU2ltdWxhdG9yKScsXG4gICAgICAgICdpUGFkIDIgKDkuMikgWzQ0NDRFQjFFLUJBNDgtNERGQS1CMTZDLTc3NzE3MUZDRjNCQ10gKFNpbXVsYXRvciknLFxuICAgICAgICAnaVBhZCBBaXIgKDguNCkgW0YyNjI3OUU3LThCQUYtNEQ3Qi1BQkZFLTA4RDFBQzM2NERDRl0gKFNpbXVsYXRvciknXG4gICAgICBdO1xuICAgICAgbW9ja3MudHBcbiAgICAgICAgLmV4cGVjdHMoJ2V4ZWMnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh7c3Rkb3V0OiAnL2EvYi9jL2RcXG4nLCBzdGRlcnI6JycgfSkpO1xuICAgICAgbW9ja3MudHBcbiAgICAgICAgLmV4cGVjdHMoJ2V4ZWMnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh7c3Rkb3V0OiBpbnN0cnVtZW50c091dHB1dCwgc3RkZXJyOicnIH0pKTtcbiAgICAgIChhd2FpdCB1dGlscy5nZXRBdmFpbGFibGVEZXZpY2VzKCkpLnNob3VsZC5kZWVwLmVxdWFsKGRldmljZXMpO1xuICAgICAgdmVyaWZ5KG1vY2tzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHdvcmsgZm9yIFhjb2RlIDcuMC03LjInLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgaW5zdHJ1bWVudHNPdXRwdXQgPSBgS25vd24gRGV2aWNlczpcbklOc2Fpa3Jpc3YgW0M4NDc2RkY5LTlCQzQtNUU1Mi1BRTNELTUzNkEyRTg1RDQzQl1cbkFwcGl1bVBhcmFsbGVsMSAoOS4yKSBbMDEyMEMzMDYtOTVDMS00MTk2LUJDMTMtNDE5NjEwNUVCRUY5XVxuQXBwbGUgVFYgMTA4MHAgKDkuMSkgW0M1OTU3MTA4LTZCQTQtNEE5OC05QTgzLTRCRUQ0N0VGRjFCQ11cbmlQYWQgMiAoOC40KSBbQjQ1MjY0QTAtNTUxQy00MUE1LUE2MzYtODIxMUMwNUQ4MDAzXVxuaVBhZCAyICg5LjIpIFs0NDQ0RUIxRS1CQTQ4LTRERkEtQjE2Qy03NzcxNzFGQ0YzQkNdXG5pUGFkIEFpciAoOC40KSBbRjI2Mjc5RTctOEJBRi00RDdCLUFCRkUtMDhEMUFDMzY0RENGXWA7XG4gICAgICBsZXQgZGV2aWNlcyA9IFtcbiAgICAgICAgJ0FwcGl1bVBhcmFsbGVsMSAoOS4yKSBbMDEyMEMzMDYtOTVDMS00MTk2LUJDMTMtNDE5NjEwNUVCRUY5XScsXG4gICAgICAgICdBcHBsZSBUViAxMDgwcCAoOS4xKSBbQzU5NTcxMDgtNkJBNC00QTk4LTlBODMtNEJFRDQ3RUZGMUJDXScsXG4gICAgICAgICdpUGFkIDIgKDguNCkgW0I0NTI2NEEwLTU1MUMtNDFBNS1BNjM2LTgyMTFDMDVEODAwM10nLFxuICAgICAgICAnaVBhZCAyICg5LjIpIFs0NDQ0RUIxRS1CQTQ4LTRERkEtQjE2Qy03NzcxNzFGQ0YzQkNdJyxcbiAgICAgICAgJ2lQYWQgQWlyICg4LjQpIFtGMjYyNzlFNy04QkFGLTREN0ItQUJGRS0wOEQxQUMzNjREQ0ZdJ1xuICAgICAgXTtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogJy9hL2IvYy9kXFxuJywgc3RkZXJyOicnIH0pKTtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogaW5zdHJ1bWVudHNPdXRwdXQsIHN0ZGVycjonJyB9KSk7XG4gICAgICAoYXdhaXQgdXRpbHMuZ2V0QXZhaWxhYmxlRGV2aWNlcygpKS5zaG91bGQuZGVlcC5lcXVhbChkZXZpY2VzKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB3b3JrIGZvciBYY29kZSA2JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGluc3RydW1lbnRzT3V0cHV0ID0gYEtub3duIERldmljZXM6XG5JTnNhaWtyaXN2IFtDODQ3NkZGOS05QkM0LTVFNTItQUUzRC01MzZBMkU4NUQ0M0JdXG5BcHBpdW1QYXJhbGxlbDEgKDguNCBTaW11bGF0b3IpIFswMTIwQzMwNi05NUMxLTQxOTYtQkMxMy00MTk2MTA1RUJFRjldXG5BcHBsZSBUViAxMDgwcCAoOC40IFNpbXVsYXRvcikgW0M1OTU3MTA4LTZCQTQtNEE5OC05QTgzLTRCRUQ0N0VGRjFCQ11cbmlQYWQgMiAoOC40IFNpbXVsYXRvcikgW0I0NTI2NEEwLTU1MUMtNDFBNS1BNjM2LTgyMTFDMDVEODAwM11cbmlQYWQgQWlyICg4LjIgU2ltdWxhdG9yKSBbRjI2Mjc5RTctOEJBRi00RDdCLUFCRkUtMDhEMUFDMzY0RENGXWA7XG4gICAgICBsZXQgZGV2aWNlcyA9IFtcbiAgICAgICAgJ0FwcGl1bVBhcmFsbGVsMSAoOC40IFNpbXVsYXRvcikgWzAxMjBDMzA2LTk1QzEtNDE5Ni1CQzEzLTQxOTYxMDVFQkVGOV0nLFxuICAgICAgICAnQXBwbGUgVFYgMTA4MHAgKDguNCBTaW11bGF0b3IpIFtDNTk1NzEwOC02QkE0LTRBOTgtOUE4My00QkVENDdFRkYxQkNdJyxcbiAgICAgICAgJ2lQYWQgMiAoOC40IFNpbXVsYXRvcikgW0I0NTI2NEEwLTU1MUMtNDFBNS1BNjM2LTgyMTFDMDVEODAwM10nLFxuICAgICAgICAnaVBhZCBBaXIgKDguMiBTaW11bGF0b3IpIFtGMjYyNzlFNy04QkFGLTREN0ItQUJGRS0wOEQxQUMzNjREQ0ZdJ1xuICAgICAgXTtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogJy9hL2IvYy9kXFxuJywgc3RkZXJyOicnIH0pKTtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogaW5zdHJ1bWVudHNPdXRwdXQsIHN0ZGVycjonJyB9KSk7XG4gICAgICAoYXdhaXQgdXRpbHMuZ2V0QXZhaWxhYmxlRGV2aWNlcygpKS5zaG91bGQuZGVlcC5lcXVhbChkZXZpY2VzKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIEluc3RydW1lbnRzIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja3MudHBcbiAgICAgICAgLmV4cGVjdHMoJ2V4ZWMnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh7c3Rkb3V0OiAnL2EvYi9jL2RcXG4nLCBzdGRlcnI6JycgfSkpO1xuICAgICAgbW9ja3MudHBcbiAgICAgICAgLmV4cGVjdHMoJ2V4ZWMnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC50aHJvd3MobmV3IEVycm9yKCdJbnN0cnVtZW50cyBmYWlsZWQnKSk7XG4gICAgICBhd2FpdCB1dGlscy5nZXRBdmFpbGFibGVEZXZpY2VzKCkuc2hvdWxkLmJlLnJlamVjdGVkV2l0aCgvRmFpbGVkIGdldHRpbmcgZGV2aWNlcywgZXJyOiBFcnJvcjogSW5zdHJ1bWVudHMgZmFpbGVkLi8pO1xuICAgICAgdmVyaWZ5KG1vY2tzKTtcbiAgICB9KTtcbiAgfSkpO1xuICBkZXNjcmliZSgna2lsbEFsbEluc3RydW1lbnRzJywgd2l0aE1vY2tzKHt0cH0sIChtb2NrcykgPT4ge1xuICAgIGl0KCdzaG91bGQgd29yaycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoe3N0ZG91dDogJycsIHN0ZGVycjonJyB9KSk7XG4gICAgICBhd2FpdCB1dGlscy5raWxsQWxsSW5zdHJ1bWVudHMoKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gIH0pKTtcbiAgZGVzY3JpYmUoJ2NsZWFuQWxsVHJhY2VzJywgd2l0aE1vY2tzKHtmc30sIChtb2NrcykgPT4ge1xuICAgIHN0dWJFbnYoKTtcbiAgICBpdCgnc2hvdWxkIHdvcmsnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5DTEVBTl9UUkFDRVMgPSAxO1xuICAgICAgbW9ja3MuZnNcbiAgICAgICAgLmV4cGVjdHMoJ3JpbXJhZicpXG4gICAgICAgIC5vbmNlKClcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHtzdGRvdXQ6ICcnLCBzdGRlcnI6JycgfSkpO1xuICAgICAgYXdhaXQgdXRpbHMuY2xlYW5BbGxUcmFjZXMoKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gIH0pKTtcbiAgZGVzY3JpYmUoJ3BhcnNlTGF1bmNoVGltZW91dCcsICgpID0+IHtcbiAgICBzdHViRW52KCk7XG4gICAgaXQoJ3Nob3VsZCB3b3JrJywgKCkgPT4ge1xuICAgICAgdXRpbHMucGFyc2VMYXVuY2hUaW1lb3V0KDkwMDAwKS5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgIGdsb2JhbDogOTAwMDAgfSk7XG4gICAgICB1dGlscy5wYXJzZUxhdW5jaFRpbWVvdXQoJzkwMDAwJykuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICBnbG9iYWw6IDkwMDAwIH0pO1xuICAgICAgdXRpbHMucGFyc2VMYXVuY2hUaW1lb3V0KHtnbG9iYWw6IDkwMDAwLCBhZnRlckxhdW5jaDogMzAwMDB9KS5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgIGdsb2JhbDogOTAwMDAsIGFmdGVyTGF1bmNoOiAzMDAwMCB9KTtcbiAgICAgIHV0aWxzLnBhcnNlTGF1bmNoVGltZW91dCgne1wiZ2xvYmFsXCI6IDkwMDAwLCBcImFmdGVyTGF1bmNoXCI6IDMwMDAwfScpLnNob3VsZC5kZWVwLmVxdWFsKHtcbiAgICAgICAgZ2xvYmFsOiA5MDAwMCwgYWZ0ZXJMYXVuY2g6IDMwMDAwIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGludmFsaWQgSlNPTicsICgpID0+IHtcbiAgICAgIHV0aWxzLnBhcnNlTGF1bmNoVGltZW91dCgneCcpLnNob3VsZC5lcXVhbCgneCcpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dldEl3ZFBhdGgnLCB3aXRoTW9ja3Moe2ZzfSwgKG1vY2tzKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB3b3JrIHdoZW4gcGF0aCBpcyBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLmZzXG4gICAgICAgIC5leHBlY3RzKCdleGlzdHMnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XG4gICAgICAoYXdhaXQgdXRpbHMuZ2V0SXdkUGF0aCgnMTAnKSkuc2hvdWxkLm1hdGNoKFxuICAgICAgICAvLip0aGlyZHBhcnR5XFwvaXdkMTAvKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB3b3JrIHdoZW4gcGF0aCBpcyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5mc1xuICAgICAgICAuZXhwZWN0cygnZXhpc3RzJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAucmV0dXJucyhQcm9taXNlLnJlc29sdmUoZmFsc2UpKTtcbiAgICAgIChhd2FpdCB1dGlscy5nZXRJd2RQYXRoKCcxMCcpKS5zaG91bGQubWF0Y2goXG4gICAgICAgIC8uKnRoaXJkcGFydHlcXC9pd2QvKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gIH0pKTtcblxuICBkZXNjcmliZSgncXVpY2tMYXVuY2gnLCB3aXRoTW9ja3Moe2ZzLCB0cH0sIChtb2NrcykgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIHRyYWNlIGRpcmVjdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLmZzXG4gICAgICAgIC5leHBlY3RzKCdyaW1yYWYnKVxuICAgICAgICAub25jZSgpXG4gICAgICAgIC5yZXR1cm5zKFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgIG1vY2tzLnRwXG4gICAgICAgIC5leHBlY3RzKCdleGVjJylcbiAgICAgICAgLm9uY2UoKVxuICAgICAgICAud2l0aEFyZ3MoJ3hjcnVuJylcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHtzdGRvdXQ6ICcnLCBzdGRlcnI6JycgfSkpO1xuICAgICAgYXdhaXQgdXRpbHMucXVpY2tMYXVuY2goKTtcbiAgICAgIHZlcmlmeShtb2Nrcyk7XG4gICAgfSk7XG4gIH0pKTtcblxuICBkZXNjcmliZSgncXVpY2tJbnN0cnVtZW50cycsIHdpdGhNb2Nrcyh7eGNvZGV9LCAobW9ja3MpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBJbnN0cnVtZW50cyBvYmplY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgaW5zdCA9IGF3YWl0IHV0aWxzLnF1aWNrSW5zdHJ1bWVudHMoe1xuICAgICAgICB4Y29kZVRyYWNlVGVtcGxhdGVQYXRoOiAnL3NvbWUvcGF0aCdcbiAgICAgIH0pO1xuICAgICAgaW5zdC5zaG91bGQuYmUuYW4uaW5zdGFuY2VvZihJbnN0cnVtZW50cyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB4Y29kZSB0cmFjZSB0ZW1wbGF0ZSBpZiBub25lIHN1cHBsaWVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja3MueGNvZGVcbiAgICAgICAgLmV4cGVjdHMoJ2dldEF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCcpXG4gICAgICAgIC5vbmNlKClcbiAgICAgICAgLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKCcvc29tZS9wYXRoJykpO1xuICAgICAgbGV0IGluc3QgPSBhd2FpdCB1dGlscy5xdWlja0luc3RydW1lbnRzKCk7XG4gICAgICBpbnN0LnRlbXBsYXRlLnNob3VsZC5lcXVhbCgnL3NvbWUvcGF0aCcpO1xuICAgIH0pO1xuICB9KSk7XG59KTtcbiJdfQ==