require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _teen_process = require('teen_process');

var TeenProcess = _interopRequireWildcard(_teen_process);

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

var _nodeSimctl = require('node-simctl');

var nodeSimctl = _interopRequireWildcard(_nodeSimctl);

var _ = require('../..');

var _assetsDeviceList = require('../assets/deviceList');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var XCODE_VERSION_7 = {
  versionString: '7.1.1',
  versionFloat: 7.1,
  major: 7,
  minor: 1,
  patch: 1
};
var XCODE_VERSION_6 = {
  versionString: '6.1.1',
  versionFloat: 6.1,
  major: 6,
  minor: 1,
  patch: 1
};

describe('util', function () {
  var execStub = undefined;
  var xcodeMock = undefined;
  var getDevicesStub = undefined;

  beforeEach(function () {
    execStub = _sinon2['default'].stub(TeenProcess, 'exec');
    xcodeMock = _sinon2['default'].mock(_appiumXcode2['default']);
    getDevicesStub = _sinon2['default'].stub(nodeSimctl, 'getDevices');
    getDevicesStub.returns(_bluebird2['default'].resolve(_assetsDeviceList.devices));
  });
  afterEach(function () {
    execStub.restore();
    xcodeMock.restore();
    nodeSimctl.getDevices.restore();
  });

  describe('killAllSimulators', function () {
    it('should call exec with Simulator for Xcode 7', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_bluebird2['default'].resolve(XCODE_VERSION_7));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 3:
            execStub.calledOnce.should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should call exec with iOS Simulator for Xcode 6', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_bluebird2['default'].resolve(XCODE_VERSION_6));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 3:
            execStub.calledOnce.should.be['true'];

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should continue if application is not running error gets thrown', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeMock.expects('getVersion').withArgs(true).returns(_bluebird2['default'].resolve(XCODE_VERSION_7));
            execStub.throws('{"stdout":"","stderr":"0:24: execution error: iOS Simulator got an error: Application isnâ€™t running. (-600)\n","code":1}');
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.killAllSimulators)());

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('endAllSimulatorDaemons', function () {
    it('should call exec five times to stop and remove each service', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.endAllSimulatorDaemons)());

          case 2:
            execStub.callCount.should.equal(5);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should ignore all errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            execStub.throws();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _.endAllSimulatorDaemons)().should.not.be.rejected);

          case 3:
            execStub.callCount.should.equal(5);
            execStub.threw().should.be['true'];

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('simExists', function () {
    it('returns true if device is found', function callee$2$0() {
      var existence, results, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, result;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            existence = [(0, _.simExists)('C09B34E5-7DCB-442E-B79C-AB6BC0357417'), (0, _.simExists)('FA5C971D-4E05-4AA3-B48B-C9619C7453BE'), (0, _.simExists)('E46EFA59-E2B4-4FF9-B290-B61F3CFECC65'), (0, _.simExists)('F33783B2-9EE9-4A99-866E-E126ADBAD410')];
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(existence));

          case 3:
            results = context$3$0.sent;
            _iteratorNormalCompletion = true;
            _didIteratorError = false;
            _iteratorError = undefined;
            context$3$0.prev = 7;

            for (_iterator = _getIterator(results); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              result = _step.value;

              result.should.be['true'];
            }
            context$3$0.next = 15;
            break;

          case 11:
            context$3$0.prev = 11;
            context$3$0.t0 = context$3$0['catch'](7);
            _didIteratorError = true;
            _iteratorError = context$3$0.t0;

          case 15:
            context$3$0.prev = 15;
            context$3$0.prev = 16;

            if (!_iteratorNormalCompletion && _iterator['return']) {
              _iterator['return']();
            }

          case 18:
            context$3$0.prev = 18;

            if (!_didIteratorError) {
              context$3$0.next = 21;
              break;
            }

            throw _iteratorError;

          case 21:
            return context$3$0.finish(18);

          case 22:
            return context$3$0.finish(15);

          case 23:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this, [[7, 11, 15, 23], [16,, 18, 22]]);
    });

    it('returns false if device is not found', function callee$2$0() {
      var existence, results, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, result;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            existence = [];

            existence.push((0, _.simExists)('A94E4CD7-D412-4198-BCD4-26799672975E'));
            existence.push((0, _.simExists)('asdf'));
            existence.push((0, _.simExists)(4));

            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(existence));

          case 6:
            results = context$3$0.sent;
            _iteratorNormalCompletion2 = true;
            _didIteratorError2 = false;
            _iteratorError2 = undefined;
            context$3$0.prev = 10;

            for (_iterator2 = _getIterator(results); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              result = _step2.value;

              result.should.be['false'];
            }
            context$3$0.next = 18;
            break;

          case 14:
            context$3$0.prev = 14;
            context$3$0.t0 = context$3$0['catch'](10);
            _didIteratorError2 = true;
            _iteratorError2 = context$3$0.t0;

          case 18:
            context$3$0.prev = 18;
            context$3$0.prev = 19;

            if (!_iteratorNormalCompletion2 && _iterator2['return']) {
              _iterator2['return']();
            }

          case 21:
            context$3$0.prev = 21;

            if (!_didIteratorError2) {
              context$3$0.next = 24;
              break;
            }

            throw _iteratorError2;

          case 24:
            return context$3$0.finish(21);

          case 25:
            return context$3$0.finish(18);

          case 26:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this, [[10, 14, 18, 26], [19,, 21, 25]]);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC91dGlscy1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztvQkFFaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7cUJBQzNCLE9BQU87Ozs7d0JBQ1gsVUFBVTs7Ozs0QkFDSyxjQUFjOztJQUEvQixXQUFXOzsyQkFDTCxjQUFjOzs7OzBCQUNKLGFBQWE7O0lBQTdCLFVBQVU7O2dCQUMrQyxPQUFPOztnQ0FDcEQsc0JBQXNCOztBQUc5QyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLElBQU0sZUFBZSxHQUFHO0FBQ3RCLGVBQWEsRUFBRSxPQUFPO0FBQ3RCLGNBQVksRUFBRSxHQUFHO0FBQ2pCLE9BQUssRUFBRSxDQUFDO0FBQ1IsT0FBSyxFQUFFLENBQUM7QUFDUixPQUFLLEVBQUUsQ0FBQztDQUNULENBQUM7QUFDRixJQUFNLGVBQWUsR0FBRztBQUN0QixlQUFhLEVBQUUsT0FBTztBQUN0QixjQUFZLEVBQUUsR0FBRztBQUNqQixPQUFLLEVBQUUsQ0FBQztBQUNSLE9BQUssRUFBRSxDQUFDO0FBQ1IsT0FBSyxFQUFFLENBQUM7Q0FDVCxDQUFDOztBQUVGLFFBQVEsQ0FBQyxNQUFNLEVBQUUsWUFBTTtBQUNyQixNQUFJLFFBQVEsWUFBQSxDQUFDO0FBQ2IsTUFBSSxTQUFTLFlBQUEsQ0FBQztBQUNkLE1BQUksY0FBYyxZQUFBLENBQUM7O0FBRW5CLFlBQVUsQ0FBQyxZQUFNO0FBQ2YsWUFBUSxHQUFHLG1CQUFNLElBQUksQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDM0MsYUFBUyxHQUFHLG1CQUFNLElBQUksMEJBQU8sQ0FBQztBQUM5QixrQkFBYyxHQUFHLG1CQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDdEQsa0JBQWMsQ0FBQyxPQUFPLENBQUMsc0JBQUUsT0FBTywyQkFBUyxDQUFDLENBQUM7R0FD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LHFCQUFTLEdBQUcsRUFBRTs7QUFDbEIscUJBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQVUsc0NBQXNDLENBQUMsQ0FBQyxDQUFDO0FBQ2xFLHFCQUFTLENBQUMsSUFBSSxDQUFDLGlCQUFVLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDbEMscUJBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7OzZDQUVULHNCQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUM7OztBQUFoQyxtQkFBTzs7Ozs7O0FBRVgsMkNBQW1CLE9BQU8seUdBQUU7QUFBbkIsb0JBQU07O0FBQ2Isb0JBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxTQUFNLENBQUM7YUFDeEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQUNGLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvdXRpbHMtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0ICogYXMgVGVlblByb2Nlc3MgZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0ICogYXMgbm9kZVNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgeyBraWxsQWxsU2ltdWxhdG9ycywgZW5kQWxsU2ltdWxhdG9yRGFlbW9ucywgc2ltRXhpc3RzIH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgZGV2aWNlcyB9IGZyb20gJy4uL2Fzc2V0cy9kZXZpY2VMaXN0JztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBYQ09ERV9WRVJTSU9OXzcgPSB7XG4gIHZlcnNpb25TdHJpbmc6ICc3LjEuMScsXG4gIHZlcnNpb25GbG9hdDogNy4xLFxuICBtYWpvcjogNyxcbiAgbWlub3I6IDEsXG4gIHBhdGNoOiAxXG59O1xuY29uc3QgWENPREVfVkVSU0lPTl82ID0ge1xuICB2ZXJzaW9uU3RyaW5nOiAnNi4xLjEnLFxuICB2ZXJzaW9uRmxvYXQ6IDYuMSxcbiAgbWFqb3I6IDYsXG4gIG1pbm9yOiAxLFxuICBwYXRjaDogMVxufTtcblxuZGVzY3JpYmUoJ3V0aWwnLCAoKSA9PiB7XG4gIGxldCBleGVjU3R1YjtcbiAgbGV0IHhjb2RlTW9jaztcbiAgbGV0IGdldERldmljZXNTdHViO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGV4ZWNTdHViID0gc2lub24uc3R1YihUZWVuUHJvY2VzcywgJ2V4ZWMnKTtcbiAgICB4Y29kZU1vY2sgPSBzaW5vbi5tb2NrKHhjb2RlKTtcbiAgICBnZXREZXZpY2VzU3R1YiA9IHNpbm9uLnN0dWIobm9kZVNpbWN0bCwgJ2dldERldmljZXMnKTtcbiAgICBnZXREZXZpY2VzU3R1Yi5yZXR1cm5zKEIucmVzb2x2ZShkZXZpY2VzKSk7XG4gIH0pO1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGV4ZWNTdHViLnJlc3RvcmUoKTtcbiAgICB4Y29kZU1vY2sucmVzdG9yZSgpO1xuICAgIG5vZGVTaW1jdGwuZ2V0RGV2aWNlcy5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdraWxsQWxsU2ltdWxhdG9ycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGwgZXhlYyB3aXRoIFNpbXVsYXRvciBmb3IgWGNvZGUgNycsIGFzeW5jICgpID0+IHtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykud2l0aEFyZ3ModHJ1ZSkucmV0dXJucyhCLnJlc29sdmUoWENPREVfVkVSU0lPTl83KSk7XG4gICAgICBhd2FpdCBraWxsQWxsU2ltdWxhdG9ycygpO1xuICAgICAgZXhlY1N0dWIuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNhbGwgZXhlYyB3aXRoIGlPUyBTaW11bGF0b3IgZm9yIFhjb2RlIDYnLCBhc3luYyAoKSA9PiB7XG4gICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLndpdGhBcmdzKHRydWUpLnJldHVybnMoQi5yZXNvbHZlKFhDT0RFX1ZFUlNJT05fNikpO1xuICAgICAgYXdhaXQga2lsbEFsbFNpbXVsYXRvcnMoKTtcbiAgICAgIGV4ZWNTdHViLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjb250aW51ZSBpZiBhcHBsaWNhdGlvbiBpcyBub3QgcnVubmluZyBlcnJvciBnZXRzIHRocm93bicsIGFzeW5jICgpID0+IHtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykud2l0aEFyZ3ModHJ1ZSkucmV0dXJucyhCLnJlc29sdmUoWENPREVfVkVSU0lPTl83KSk7XG4gICAgICBleGVjU3R1Yi50aHJvd3MoJ3tcInN0ZG91dFwiOlwiXCIsXCJzdGRlcnJcIjpcIjA6MjQ6IGV4ZWN1dGlvbiBlcnJvcjogaU9TIFNpbXVsYXRvciBnb3QgYW4gZXJyb3I6IEFwcGxpY2F0aW9uIGlzbuKAmXQgcnVubmluZy4gKC02MDApXFxuXCIsXCJjb2RlXCI6MX0nKTtcbiAgICAgIGF3YWl0IGtpbGxBbGxTaW11bGF0b3JzKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlbmRBbGxTaW11bGF0b3JEYWVtb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsbCBleGVjIGZpdmUgdGltZXMgdG8gc3RvcCBhbmQgcmVtb3ZlIGVhY2ggc2VydmljZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGVuZEFsbFNpbXVsYXRvckRhZW1vbnMoKTtcbiAgICAgIGV4ZWNTdHViLmNhbGxDb3VudC5zaG91bGQuZXF1YWwoNSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBpZ25vcmUgYWxsIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGV4ZWNTdHViLnRocm93cygpO1xuICAgICAgYXdhaXQgZW5kQWxsU2ltdWxhdG9yRGFlbW9ucygpLnNob3VsZC5ub3QuYmUucmVqZWN0ZWQ7XG4gICAgICBleGVjU3R1Yi5jYWxsQ291bnQuc2hvdWxkLmVxdWFsKDUpO1xuICAgICAgZXhlY1N0dWIudGhyZXcoKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NpbUV4aXN0cycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIGRldmljZSBpcyBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdGVuY2UgPSBbXG4gICAgICAgIHNpbUV4aXN0cygnQzA5QjM0RTUtN0RDQi00NDJFLUI3OUMtQUI2QkMwMzU3NDE3JyksXG4gICAgICAgIHNpbUV4aXN0cygnRkE1Qzk3MUQtNEUwNS00QUEzLUI0OEItQzk2MTlDNzQ1M0JFJyksXG4gICAgICAgIHNpbUV4aXN0cygnRTQ2RUZBNTktRTJCNC00RkY5LUIyOTAtQjYxRjNDRkVDQzY1JyksXG4gICAgICAgIHNpbUV4aXN0cygnRjMzNzgzQjItOUVFOS00QTk5LTg2NkUtRTEyNkFEQkFENDEwJylcbiAgICAgIF07XG5cbiAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgQi5hbGwoZXhpc3RlbmNlKTtcblxuICAgICAgZm9yIChsZXQgcmVzdWx0IG9mIHJlc3VsdHMpIHtcbiAgICAgICAgcmVzdWx0LnNob3VsZC5iZS50cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgZmFsc2UgaWYgZGV2aWNlIGlzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdGVuY2UgPSBbXTtcbiAgICAgIGV4aXN0ZW5jZS5wdXNoKHNpbUV4aXN0cygnQTk0RTRDRDctRDQxMi00MTk4LUJDRDQtMjY3OTk2NzI5NzVFJykpO1xuICAgICAgZXhpc3RlbmNlLnB1c2goc2ltRXhpc3RzKCdhc2RmJykpO1xuICAgICAgZXhpc3RlbmNlLnB1c2goc2ltRXhpc3RzKDQpKTtcblxuICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCBCLmFsbChleGlzdGVuY2UpO1xuXG4gICAgICBmb3IgKGxldCByZXN1bHQgb2YgcmVzdWx0cykge1xuICAgICAgICByZXN1bHQuc2hvdWxkLmJlLmZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
